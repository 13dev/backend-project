const { Malware, Type } = require('../models');
module.exports = new class MalwareController {
    index(request, response, next) {
        Malware
            .findAll()
            .then(result => {
                // Type.findOne({where: { id: result.type_id }}).then(type => {
                //     result.type = type
                //     return response.formatter.ok(result)
                // })
                return response.formatter.ok(result)
            })
            .catch(result => response.formatter.serverError(result));

    }
    //TO FIND A CERTAIN MALWARE
    findMalware(request, response, next) {
        Malware.findOne({
            where: { name: request.params.malwareName }
        })
            .then((result) => response.formatter.ok(result))
            .catch((result) => response.formatter.serverError(result));
    }
    //TO CREATE A MALWARE
    createMalware(request, response, next) {
        Malware.create({
            user_id: request.body.user_id,
            name: request.body.name,
            dangerLevel: request.body.dangerLevel,
            description: request.body.description,
            type_id: request.body.type,
            active: request.body.active,
        })
            .then((result) => response.formatter.ok(result))
            .catch((result) => response.formatter.serverError(result));
    }
    //TO UPDATE A MALWARE
    updateMalware(request, response, next) {
        Malware.update({
            user_id: request.body.user_id,
            name: request.body.name,
            dangerLevel: request.body.dangerLevel,
            description: request.body.description,
            type_id: request.body.type,
            active: request.body.active,
        }, { where: { id: request.params.id } })
            .then((result) => response.formatter.ok(result))
            .catch((result) => response.formatter.serverError(result));
    }
    //delete a malware by id
    deleteMalware(request, response, next) {
        Malware.destroy({ where: { id: request.params.id } })
            .then((result) => response.formatter.ok(result))
            .catch((result) => response.formatter.serverError(result));
    }
    //GET MALWARES POSTED BY A USER
    getMalwareByUser(request, response, next) {
        Malware.findAll({ where: { user_id: request.params.userId } })
            .then((result) => response.formatter.ok(result))
            .catch((result) => response.formatter.serverError(result));
    }

    //GET MALWARES BY ITS TYPE
    getMalwareByType(request, response, next) {
        Malware.findAll({ where: { type: request.params.typeId } })
            .then((result) => response.formatter.ok(result))
            .catch((result) => response.formatter.serverError(result));
    }

    uploadMalwareImage(request, response, next) {
        console.log("teste")

        response.formatter.ok("ficheiro enviado com sucesso!");
    }
};